<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>post</title>
    <base th:href="@{/}"/>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- 富文本css -->
    <link href="css/index.css" rel="stylesheet">
    <link href="css/prettify.css" rel="stylesheet">
    <!-- <link href="bootstrap-combined.no-icons.min.css" rel="stylesheet"> -->
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="css/layui.css">

    <style>
        .no-url {
            display: none;
        }

        .div0 {
            min-width: 970px;
            background-color: #f5f6f7;
            /*background-color: rgb(250, 250, 250);*/
            /*background: url(beijing.jpg);*/
            min-height: 1000px;
        }

        /* ======================= */
        /* ===阿里图库的图片样式 === */
        /* ======================= */
        .icon, .icon-a {
            width: 1em;
            height: 1em;
            vertical-align: -0.15em;
            fill: currentColor;
            overflow: hidden;
        }

        .row1 {
            margin-top: 64px;
        }

        .panel-body {
            padding: 0px;
        }

        .post {
            min-height: 130px;
            border-top: solid 1px rgb(236, 236, 236);
            position: relative;
            overflow: hidden;
            border-bottom: solid 1px rgb(236, 236, 236);
        }

        .postbottom {
            min-height: 130px;
            border-top: solid 1px rgb(236, 236, 236);
            position: relative;
            overflow: hidden;
            border-bottom: solid 1px rgb(236, 236, 236);
        }

        .post-left {
            position: absolute;
            left: 0;
            width: 27%;
            height: 100%;
            background-color: rgb(250, 250, 250);
        }

        .post-left-img {
            position: absolute;
            left: 30px;
            top: 20px;
            cursor: pointer;
        }

        .post-left-user {
            position: absolute;
            left: 130px;
            top: 25px;
            font-size: 18px;
            font-weight: bold;
        }

        .post-left-user:hover {
            cursor: pointer;
            color: cornflowerblue;
        }

        .post-left-users {
            position: absolute;
            left: 130px;
            top: 50px;
            font-size: 14px;
            font-weight: bold;
        }

        .post-left-label {
            position: absolute;
            left: 130px;
            top: 74px;
            font-size: 15px;
            font-weight: bold;
        }

        .post-left-name1 {
            float: right;
            color: rgb(223, 188, 75);
        }

        .post-right {
            float: right;
            margin: 1%;
            padding-bottom: 10px;
            width: 71%;
            height: 100%;
            word-wrap: break-word;
            font-size: 17px;
        }

        .post-right-data {
            position: absolute;
            bottom: 3px;
            left: 28%;
            font-size: 13px;
            color: #DDD;
        }

        .post-right-good {
            position: absolute;
            bottom: 3px;
            right: 100px;
            font-size: 13px;
            color: #DDD;
            cursor: pointer;
        }

        .post-right-good:hover {
            color: tomato;
        }

        .post-right-reply {
            position: absolute;
            bottom: 3px;
            right: 47px;
            font-size: 13px;
            color: #DDD;
            cursor: pointer;
        }

        .post-right-goodin {
            color: tomato;
        }

        .post-right-sum {
            position: absolute;
            bottom: 3px;
            right: 10px;
            font-size: 13px;
            color: #666;
        }

        .post2 {
            min-height: 30px;
            /* border-bottom:solid 1px rgb(226, 226, 226); */
            position: relative;
            overflow: hidden;
            background-color: rgb(242, 242, 242);
        }

        .post-lzl {
            float: right;
            margin: 1%;
            padding-bottom: 10px;
            width: 98%;
            height: 100%;
            word-wrap: break-word;
            font-size: 17px;
        }

        .post-lzl-name {
            margin: 0 10px;
            /* color: rgb(238, 175, 92); */
            color: rgb(233, 171, 90);
            cursor: pointer;
        }

        .post-lzl-right {
            float: right;
            padding: 1%;
            padding-bottom: 20px;
            width: 73%;
            height: 100%;
            word-wrap: break-word;
            font-size: 17px;
            border-top: solid 1px rgb(223, 223, 223);
        }

        .post-button {
            text-align: center;
            position: absolute;
            background-color: rgb(46, 202, 250);
            font-weight: 500;
            color: rgb(255, 255, 255);
            font-size: 16px;
            font-weight: bold;
            border-radius: 7px;
            padding: 5px;
            width: 200px;
            bottom: -55px;
            left: calc(50% - 100px);
            cursor: pointer;
        }

        .post-button:hover {
            background-color: rgb(46, 168, 206);
        }

        .right-bottom {
            /* border:solid 1px rgb(170, 170, 170);
            border-radius: 6px; */
            line-height: 25px;
            text-align: center;
            height: 80px;
            margin-top: 15px;
            background-color: #fff;
            font-size: 14px;
            color: #BBB;
            border-radius: 5px;
        }

        .buttonfengye {
            cursor: pointer;
        }

        .buttonOn {
            background-color: #eee !important;
        }

        .onright {
            padding: 0;
        }

        /*.onright-body {*/
        /*    cursor: pointer;*/
        /*}*/

        /*.onright-body:hover {*/
        /*    background-color: rgb(228, 228, 228);*/
        /*}*/

        .icon-b {
            position: absolute;
            left: 50%;
            top: 50%;
            margin-top: -3em;
            margin-left: -2em;
            width: 4em;
            height: 4em;
            vertical-align: -0.15em;
            fill: currentColor;
            overflow: hidden;
        }

        .filename {
            position: relative;
            margin-top: 43%;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
            color: cornflowerblue;
            /* background-color: rgb(255, 109, 109); */
        }

        .filename > a:hover {
            cursor: pointer;
            /*border-bottom: 1px solid cornflowerblue;*/
        }

        @media screen and (max-width: 1200px) {
            #myScrollspy {
                display: none;
            }
        }

        .post-type {
            /*background-color: #BBBBBB;*/
            height: 20px;
            /*width: 150px;*/
        }

        .post-type > span:hover {
            cursor: pointer;
        }

        .star {
            height: 17px;
            width: 17px;
        }

        .star:hover {
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="div0">
    <div th:replace="nav-head :: head"></div>
    <div class="container">
        <div class="row row1">
            <div class="col-lg-11" style="">
                <div class="panel panel-default">
                    <div class="panel-heading" style="background-color: white;">
                        <h3 class="panel-title" id="title"
                            style="font-size: 21px;font-weight: bold;margin-bottom: 10px">
                            标题
                        </h3>
                        <div class="post-type">
                            <span id="post-type"
                                  style="float: left;color: cornflowerblue;display: block;width: 100px;font-weight: 400">
                            </span>
                            <img style="float: left" id="starImg" class="star"/>
                        </div>
                    </div>
                    <div class="panel-body" style="margin-bottom: 80px;position: relative;">

                        <div style="display: block;height: 75px;position: relative;" id="fengye">
                            <ul id="treeTable1" class="pagination" style="position: absolute; left: calc(50% - 115px);">
                                <li id="laquo"><a class="buttonfengye">&laquo;</a></li>
                                <li id="page1"><a class="buttonfengye">1</a></li>
                                <li id="page2"><a class="buttonfengye">2</a></li>
                                <li id="page3"><a class="buttonfengye">3</a></li>
                                <li id="page4"><a class="buttonfengye">4</a></li>
                                <li id="page5"><a class="buttonfengye">5</a></li>
                                <li id="raquo"><a class="buttonfengye">&raquo;</a></li>
                            </ul>
                        </div>

                        <div style="padding:15px;border-top:solid 1px rgb(236, 236, 236);">
                            <div style="font-weight: bold;">评论</div>
                            <!--这里加上是为了让提示信息显示 不然会被遮挡-->
                            <div class="btn-toolbar" data-role="editor-toolbar" data-target="#editor">
                                <div class="btn-group">
                                    <a class="btn dropdown-toggle" data-toggle="dropdown" title="Font"><i
                                            class="icon-font"></i><b class="caret"></b></a>
                                    <ul class="dropdown-menu"></ul>
                                </div>
                                <div class="btn-group">
                                    <a class="btn dropdown-toggle" data-toggle="dropdown" title="Font Size"><i
                                            class="icon-text-height"></i> <b class="caret"></b></a>
                                    <ul class="dropdown-menu">
                                        <li><a data-edit="fontSize 5"><font size="5">Huge</font></a></li>
                                        <li><a data-edit="fontSize 3"><font size="3">Normal</font></a></li>
                                        <li><a data-edit="fontSize 1"><font size="1">Small</font></a></li>
                                    </ul>
                                </div>
                                <div class="btn-group">
                                    <a class="btn" data-edit="bold" title="Bold (Ctrl/Cmd+B)"><i class="icon-bold"></i></a>
                                    <!--加粗-->
                                    <a class="btn" data-edit="italic" title="Italic (Ctrl/Cmd+I)"><i
                                            class="icon-italic"></i></a><!-- 斜体-->
                                    <a class="btn" data-edit="strikethrough" title="Strikethrough"><i
                                            class="icon-strikethrough"></i></a><!-- 删除线-->
                                    <a class="btn" data-edit="underline" title="Underline (Ctrl/Cmd+U)"><i
                                            class="icon-underline"></i></a><!-- 下划线-->
                                </div>
                                <div class="btn-group">
                                    <a class="btn" data-edit="insertunorderedlist" title="Bullet list"><i
                                            class="icon-list-ul"></i></a><!-- 加点-->
                                    <a class="btn" data-edit="insertorderedlist" title="Number list"><i
                                            class="icon-list-ol"></i></a><!-- 数字排序-->
                                    <a class="btn" data-edit="outdent" title="Reduce indent (Shift+Tab)"><i
                                            class="icon-indent-left"></i></a><!-- 减少缩进-->
                                    <a class="btn" data-edit="indent" title="Indent (Tab)"><i
                                            class="icon-indent-right"></i></a><!--增加缩进-->
                                </div>
                                <div class="btn-group">
                                    <a class="btn" data-edit="justifyleft" title="Align Left (Ctrl/Cmd+L)"><i
                                            class="icon-align-left"></i></a><!--左对齐-->
                                    <a class="btn" data-edit="justifycenter" title="Center (Ctrl/Cmd+E)"><i
                                            class="icon-align-center"></i></a><!--居中-->
                                    <a class="btn" data-edit="justifyright" title="Align Right (Ctrl/Cmd+R)"><i
                                            class="icon-align-right"></i></a><!--右对齐-->
                                    <a class="btn" data-edit="justifyfull" title="Justify (Ctrl/Cmd+J)"><i
                                            class="icon-align-justify"></i></a><!--垂直对齐-->
                                </div>
                                <div class="btn-group">
                                    <a class="btn dropdown-toggle" data-toggle="dropdown" title="Hyperlink"><i
                                            class="icon-link"></i></a><!-- 链接-->
                                    <div class="dropdown-menu input-append">
                                        <input class="span2" placeholder="URL" type="text" data-edit="createLink"/>
                                        <button class="btn" type="button">Add</button>
                                    </div>
                                    <a class="btn" data-edit="unlink" title="Remove Hyperlink"><i class="icon-cut"></i></a>
                                </div>
                                <div class="btn-group">
                                    <a class="btn" title="Insert picture (or just drag & drop)" id="pictureBtn"><i
                                            class="icon-picture"></i></a>
                                </div>
                                <div class="btn-group">
                                    <a class="btn" data-edit="undo" title="Undo (Ctrl/Cmd+Z)"><i class="icon-undo"></i></a>
                                    <!--撤销-->
                                    <a class="btn" data-edit="redo" title="Redo (Ctrl/Cmd+Y)"><i
                                            class="icon-repeat"></i></a><!--恢复-->
                                </div>
                                <input type="text" data-edit="inserttext" id="voiceBtn" x-webkit-speech="">
                            </div>

                            <div id="editor" style="padding:15px;">

                            </div>
                            <div class="post-button" id="go">
                                回帖
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div id="fileDiv" class="col-lg-1 onright">

                <div class="panel panel-default" style="position: fixed; width: 200px">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            附加文件
                        </h3>
                    </div>
                    <div class="panel-body onright-body" style="position: relative;height: 131px;">
                        <svg class="icon-b" aria-hidden="true">
                            <!-- 阿里图库logo -->
                            <use xlink:href="#icon-UNKNOW"></use>
                        </svg>
                        <div class="filename"><a>abc.rar</a></div>
                    </div>
                </div>
            </div>
            <div class="right-bottom col-lg-11">
                <div class="">
                    <span style="font-size: 14px;">关于我们 招贤纳士 广告服务 开发助手 400-660-XXXXX@qq.com 客服工作时间 8:30-22:00</span><br>
                    <span style="font-size: 12px;">公安备案号1101050xxxxxx 京ICP备19xxxxxx号京网文〔2021〕1039-165号 经营性网站备案信息 北京互联网违法和不良信息举报中心</span><br>
                    <span style="font-size: 12px;">网络110报警服务 中国互联网举报中心 家长监护 Chrome商店下载 ©1999-2021北京创新乐知网络技术有限公司 版权与免责声明 版权申诉</span><br>
                </div>
            </div>
            <form id="downloadForm">
                <input id="downloadUrl" name="attachmentUrl" style="display: none">
            </form>
        </div>
    </div>
</div>
</body>
<script src='js/iconfont.js'></script>
<script src='js/icon2.js'></script>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>

<script src="js/jquery.hotkeys.js"></script>
<script src="js/bootstrap-wysiwyg.js"></script>

<script src="layer/layer.js"></script>

<script th:inline="javascript">
    let map = [
        ["技术交流", 1],
        ["校闻趣事", 2],
        ["社团活动", 3],
        ["校园一角", 4],
        ["美食佳肴", 5],
        ["政史评谈", 6]
    ]
    //模拟当前用户
    let curUser = [[${session.loginUser.name}]]
    //模拟博客数据
    var testboke = {
        "total": 40,//总条数
        "size": 5,//分页大小
        "pages": 10,//总页数
        "current": 1, //当前页数
        "title": '',//标题
        "records": ''
        // [//author-riverLethe-double-slash-note数据部分
        //     {
        //         "id":17,//项目id
        //         // "headUrl"
        //         "userName":"Night夜",//用户名
        //         "fans":"645645123",//粉丝数
        //         "body":"啊实打实大苏打<i>实打实</i><strike><i>的支</i>持者宣称</strike>",//内容
        //         "time":"2021-04-01 12:00:00",//时间
        //     },
        //     {
        //         "id":16,
        //         "userName":"dasd夜",
        //         "fans":"4456545",//粉丝数
        //         "body":"Go ahead…",//内容
        //         "time":"2021-04-01 12:00:00",//时间
        //     },
        //     {
        //         "id":15,
        //         "userName":"BB机",
        //         "fans":"4645655",//粉丝数
        //         "body":"<div style='text-align: center;'>Go ahead…<b>VS的<strike>方法VS</strike>打发</b>士大夫</div>",//内容
        //         "time":"2021-04-01 12:00:00",//时间
        //     },
        //     {
        //         "id":14,
        //         "userName":"aB机",
        //         "fans":"445645645",//粉丝数
        //         "body":"<ol><li><i>Go ahead…啊实打实</i>大苏打秩序册</li></ol>",//内容
        //         "time":"2021-04-01 12:00:00",//时间
        //     },
        // ]
    }
    //模拟博客楼中楼
    // var testbokelzl = [//author-riverLethe-double-slash-note数据部分
    //     {
    //         "id": 17,//项目id
    //         "userName1": "Night夜",//用户名1
    //         "userName2": "用户2",//用户名2
    //         "body": "啊实打实大苏打<i>实打实</i><strike><i>的支</i>持者宣称</strike>",//内容
    //         "time": "2021-04-01 12:00:00",//时间
    //     },
    //     {
    //         "id": 16,
    //         "userName1": "dasd夜",
    //         "userName2": "用户33",//用户名2
    //         "body": "Go ahead…",//内容
    //         "time": "2021-04-01 12:00:00",//时间
    //     },
    //     {
    //         "id": 15,
    //         "userName1": "BB机",
    //         "body": "<div style='text-align: center;'>Go ahead…<b>VS的<strike>方法VS</strike>打发</b>士大夫</div>",//内容
    //         "time": "2021-04-01 12:00:00",//时间
    //     },
    //     {
    //         "id": 14,
    //         "userName1": "aB机",
    //         "userName2": "用户4",//用户名2
    //         "body": "<ol><li><i>Go ahead…啊实打实</i>大苏打秩序册</li></ol>",//内容
    //         "time": "2021-02-14 12:00:00",//时间
    //     },
    // ]

    let testbokelzl = null;
    //非模拟，js逻辑
    var isbutton1 = ''
    var isbutton2 = ''

    function hasThumb(type, thumbId) {
        let hasThumb = false
        // 获取当前用户id
        let userId = [[${session.loginUser.id}]]
        let hasThumbId = null
        // 要判断是否点赞的对象（论贴/评论）
        if (type == 1) {
            hasThumbId = [[${postId}]]
        } else {
            hasThumbId = thumbId
        }
        $.ajax({
            "url": "/post/has/thumb",
            "type": "post",
            "data": {
                "userId": userId,
                "type": type,
                "hasThumbId": hasThumbId
            },
            "async": false,
            "dataType": "json",
            "success": function (responseData) {
                let code = responseData.code;
                if (code == "200") {
                    hasThumb = responseData.data;
                    // console.log("加载是否已点赞：类型 "+type+"; 点否 "+hasThumb)
                } else {
                    layer.msg("获取用户点赞信息失败");
                    console.log("获取用户点赞信息失败：" + responseData.message);
                }
            },
            "error": function (response) {
                layer.msg(response.status + " " + response.statusText);
            }
        })
        return hasThumb
    }

    function que() {
        $("#title").text(testboke.title)
        for (var i = 0; i < testboke.records.length; i++) {
            let comment = testboke.records[i]
            var bokediv = ''
            // if(i == testboke.records.length-1){
            //     bokediv="<div class='postbottom' id='b"+i+"'>"
            //     // console.log(bokediv,'11111111111')
            // }else{
            //     bokediv="<div class='post' id='b"+i+"'>"
            // }
            bokediv = "<div class='post' id='b" + i + "''>"
            bokediv += "<div class='post-left'>"
            // <img src='https://static.runoob.com/images/mix/img_avatar.png' class='img-circle post-left-img' style='width:80px'>
            bokediv += "<img id='" + comment.userId + "' src='" + comment.headUrl + "' class='img-circle post-left-img' style='width:80px'>"
            bokediv += "<div id='" + comment.userId + "' class='post-left-user'>" + comment.userName + "</div>"
            bokediv += "<div class='post-left-users'><span>粉丝：</span><span>" + comment.fans + "</span></div>"
            if (comment.poster === true) {
                bokediv += "<div class='post-left-label label label-info'>楼主</div>"
            }
            bokediv += "</div>"
            bokediv += "<div class='post-right'>"
            bokediv += comment.body
            bokediv += "<div class='post-right-data'>" + comment.time.replace(/T/, " ") + "</div>"
            let commentId = comment.commentId
            let hasThumbDiv = "<div class='post-right-good post-right-goodin'>点赞(" + comment.thumbs + ")</div>"

            if (commentId == null) {
                let hasNotThumbDiv = "<div id='canThumb" + [[${postId}]] +
                    "' thumb-type='post' class='post-right-good'>点赞(<span>" + comment.thumbs + "</span>)</div>"
                // let res = hasThumb(1)
                // console.log("帖子被点赞："+(res == true))
                bokediv += (hasThumb(1) == true ? hasThumbDiv : hasNotThumbDiv)
            } else {
                let hasNotThumbDiv = "<div id='canThumb" + commentId +
                    "' thumb-type='comment' class='post-right-good'>点赞(<span>" + comment.thumbs + "</span>)</div>"
                // console.log("评论被点赞："+(hasThumb(2, commentId) == true))
                bokediv += (hasThumb(2, commentId) == true ? hasThumbDiv : hasNotThumbDiv)
            }
            if (commentId !== null) {
                bokediv += "<div class='post-right-reply' id='bokelzlgo" + commentId + "'>回复</div>"
            }

            if (testboke.current == 1 && i != 0) {
                bokediv += "<div class='post-right-sum'>" + ((testboke.current - 1) * testboke.size + i) + "楼</div>"
            } else if (testboke.current > 1) {
                bokediv += "<div class='post-right-sum'>" + ((testboke.current - 1) * testboke.size + (i + 1)) + "楼</div>"
            }
            bokediv += "</div>"
            bokediv += "</div>"
            bokediv += "<div id='bokelzldingwei" + (commentId == null ? "" : commentId) + "'></div>"//博客楼中楼定位
            $("#fengye").before(bokediv);
        }
    }

    function page() {
        $("li[id ^= page]").remove();
        var pageli = ''
        let curPage = [[${current}]]
        if (testboke.pages - curPage >= 4) {
            for (var i = 0; i < 5; i++) {
                // console.log(i,'dasdsd')
                if (i == 0) {
                    pageli += "<li id='page'"
                    pageli += " class='active'><a class='buttonfengye' id='curA'>" + curPage + "</a></li>"
                    if (curPage == 1) {
                        $("#laquo").addClass("disabled")
                    }
                } else {
                    pageli += "<li id='page'><a class='buttonfengye'>" + (i + curPage) + "</a></li>"
                }
            }

        } else {
            for (var i = 0; i < testboke.pages - curPage + 1; i++) {
                // console.log(i, 'dasdsd')
                if (i == 0) {
                    pageli += "<li id='page' class='active'><a class='buttonfengye' id='curA'>" + (i + curPage) + "</a></li>"
                    if (curPage == 1) {
                        $("#laquo").addClass("disabled")
                    }
                } else {
                    pageli += "<li id='page'><a class='buttonfengye'>" + (i + curPage) + "</a></li>"
                }
            }
        }

        $("#raquo").before(pageli)
        $("#curA").trigger("click")
    }

    $(function () {

        // 获取用户头像
        $.ajax({
            "url": "/user/get/user/head/url/" + [[${session.loginUser.id}]],
            "type": "get",
            "dataType": "json",
            "success": function (responseData) {
                if (responseData.code == 200) {
                    $("#lis").prepend(
                        "<li>" +
                        "   <a style='width: 58px; height: 50px;' href='http://www.huanforum.com/user/zone/page/" + [[${session.loginUser.id}]] + "'>" +
                        "       <img class='img-circle' width='30px' height='30px' src='" + responseData.data + "'/>" +
                        "   </a>" +
                        "</li>"
                    )
                }

            }
        })

        $("#portal").removeClass("active")

        // 获取用户未读动态及消息
        $.ajax({
            "url": "/user/personal/get/user/unread/" + [[${session.loginUser.id}]],
            "type": "get",
            "dataType": "json",
            "success": function (responseData) {
                if (responseData.code == 200) {
                    let unreadPair = responseData.data
                    let unreadActs = unreadPair.key
                    let unreadMsgs = unreadPair.value

                    if (unreadActs != 0) {
                        let unreadSpan = "<span class='layui-badge  layui-bg-green' style='margin-left: 2px'>" + unreadActs + "</span>"
                        $("#activity a").append(unreadSpan)
                    }
                    if (unreadMsgs != 0) {
                        let unreadSpan = "<span class='layui-badge  layui-bg-green' style='margin-left: 2px'>" + unreadMsgs + "</span>"
                        $("#message a").append(unreadSpan)
                    }
                }
            }
        })
        // 获取论贴内容评论信息
        $.ajax({
            "url": "/post/get/post/comment/info",
            "type": "post",
            "data": {
                "postId": [[${postId}]],
                "size": 5,
                "current": [[${current}]]
            },
            "dataType": "json",
            "async": false,
            "success": function (responseData) {
                let code = responseData.code;
                if (code === "200") {
                    let data = responseData.data;
                    // console.log(data);
                    testboke.pages = data.pages == 0 ? 1 : data.pages;
                    testboke.records = data.records;
                    // console.log(data.records)
                    // console.log(testboke.records)
                    testboke.title = data.title;
                    testboke.total = data.total;
                    testboke.current = [[${current}]];
                    testboke.attachmentUrl = data.attachmentUrl

                    $("#post-type").text(data.type)
                    $("#post-type").click(function () {
                        let typeTxt = $(this).text()
                        let type = null
                        for (let i = 0; i < map.length; i++) {
                            let typeArr = map[i]
                            if (typeArr[0] == typeTxt) {
                                type = typeArr[1]
                                break
                            }
                        }

                        window.location.href = "/post/show/" + type
                    })

                    // 获取收藏信息
                    $.ajax({
                        "url": "/user/personal/has/star/post",
                        "type": "post",
                        "data": {
                            "starId": [[${postId}]],
                            "userId": [[${session.loginUser.id}]]
                        },
                        "dataType": "json",
                        "success": function (responseData) {
                            if (responseData.code == 200) {
                                // console.log(responseData.data)
                                if (responseData.data == true) {
                                    $("#starImg").attr('src', 'img/star-off.jpg')
                                } else {
                                    $("#starImg").attr('src', 'img/star-on.png')
                                }
                            }

                        }
                    })

                    // console.log(testboke)

                    let url = testboke.attachmentUrl;
                    if (url != null) {
                        let downloadUrl = "/post/file/download/"
                        let attachmentUrl = url.slice(11)
                        $(".filename a").eq(0).text(url.substring(url.lastIndexOf("/") + 1))
                        $(".filename a").eq(0).on("click", function () {
                            $("#downloadForm").attr("action", downloadUrl)
                            $("#downloadForm").attr("method", "post")
                            $("#downloadUrl").val(attachmentUrl)
                            $("#downloadForm").submit()
                            return false
                        })
                    } else {
                        $("#fileDiv").addClass("no-url")
                    }

                    que();
                    page();
                } else {
                    layer.msg("获取帖子信息失败：" + responseData.message);
                }
            },
            "error": function (response) {
                layer.msg(response.status + " " + response.statusText);
            }
        })

        function initToolbarBootstrapBindings() {
            var fonts = ['Serif', 'Sans', 'Arial', 'Arial Black', 'Courier',
                    'Courier New', 'Comic Sans MS', 'Helvetica', 'Impact', 'Lucida Grande', 'Lucida Sans', 'Tahoma', 'Times',
                    'Times New Roman', 'Verdana'],
                fontTarget = $('[title=Font]').siblings('.dropdown-menu');
            $.each(fonts, function (idx, fontName) {
                fontTarget.append($('<li><a data-edit="fontName ' + fontName + '" style="font-family:\'' + fontName + '\'">' + fontName + '</a></li>'));
            });
            $('a[title]').tooltip({container: 'body'});
            $('.dropdown-menu input').click(function () {
                return false;
            })
                .change(function () {
                    $(this).parent('.dropdown-menu').siblings('.dropdown-toggle').dropdown('toggle');
                })
                .keydown('esc', function () {
                    this.value = '';
                    $(this).change();
                });

            $('[data-role=magic-overlay]').each(function () {
                var overlay = $(this), target = $(overlay.data('target'));
                overlay.css('opacity', 0).css('position', 'absolute').offset(target.offset()).width(target.outerWidth()).height(target.outerHeight());
            });
            $('#voiceBtn').hide();
            if ("onwebkitspeechchange" in document.createElement("input")) {
                var editorOffset = $('#editor').offset();
                $('#voiceBtn').css('position', 'absolute').offset({
                    top: editorOffset.top,
                    left: editorOffset.left + $('#editor').innerWidth() - 35
                });
            } else {
                $('#voiceBtn').hide();
            }
        };

        function showErrorAlert(reason, detail) {
            var msg = '';
            if (reason === 'unsupported-file-type') {
                msg = "Unsupported format " + detail;
            } else {
                console.log("error uploading file", reason, detail);
            }
            $('<div class="alert"> <button type="button" class="close" data-dismiss="alert">×</button>' +
                '<strong>File upload error</strong> ' + msg + ' </div>').prependTo('#alerts');
        };
        initToolbarBootstrapBindings();
        $('#editor').wysiwyg({fileUploadError: showErrorAlert});

    })
    $(document).on('click', '.img-circle', function () {
        let userId = $(this).attr('id')
        // console.log(userId)
        window.location.href = "/user/zone/page/" + userId
    })
    $(document).on('click', '.post-left-user', function () {
        let userId = $(this).attr('id')
        // console.log(userId)
        window.location.href = "/user/zone/page/" + userId
    })
    $(document).on('click', '.post-lzl-name', function () {
        let userId = $(this).attr('id')
        // console.log(userId)
        window.location.href = "/user/zone/page/" + userId
    })
    $(document).on('click', 'div[id ^= bokelzlgo]', function () {
        if (isbutton1 == $(this).attr('id')) {
            $("div[id ^= bokelzlIn]").remove();
            isbutton1 = ''
        } else {
            let commentId = $(this).attr('id').slice(9)

            let commentReplies = null
            // 请求获取评论的回复信息（本评论的回复或所属本评论回复的回复）
            $.ajax({
                "url": "/post/get/comment/reply/info",
                "type": "post",
                "data": {
                    "commentId": commentId,
                },
                "async": false,
                "dataType": "json",
                "success": function (responseData) {
                    let code = responseData.code;
                    if (code == "200") {
                        commentReplies = responseData.data;
                        // console.log(commentReplies);
                    } else {
                        layer.msg("获取评论回复信息失败：" + responseData.message);
                    }
                },
                "error": function (response) {
                    layer.msg(response.status + " " + response.statusText);
                }
            })

            $("div[id ^= bokelzlIn]").remove();
            // console.log(testbokelzl.length)
            // console.log($(this).attr('id').slice(9))

            let a = '#bokelzldingwei' + commentId
            if (commentReplies !== null) {
                for (let i = 0; i < commentReplies.length; i++) {
                    let commentReply = commentReplies[i];
                    // console.log(commentReply)
                    let replyReplyId = commentReply.replyReplyId;
                    let bokediv = "<div class='post2' id='bokelzlIn" + replyReplyId + "'>"
                    bokediv += "<div class='post-left'></div>"
                    // boKeDiv+="<div class='post-lzl'>"
                    bokediv += "<div class='post-lzl-right'>"
                    let toReplyName = commentReply.toReplyName;
                    let userName = commentReply.userName
                    if (toReplyName !== null && toReplyName != '') {
                        // console.log(testbokelzl[i].userName2)
                        bokediv += "<span id='" + commentReply.userId + "' class='post-lzl-name'>" + userName + "</span>回复<span id='" + commentReply.userId + "' class='post-lzl-name'>" + toReplyName + "</span><span style='margin-right: 20px;'>:</span>"
                    } else {
                        bokediv += "<span id='" + commentReply.userId + "' class='post-lzl-name'>" + userName + "</span><span style='margin-right: 20px;'>:</span>"
                    }
                    bokediv += commentReply.content
                    let replyTime = commentReply.time.replace(/T/, ' ')
                    bokediv += "<div class='post-right-data'>" + replyTime + "</div>"
                    if (hasThumb(3, replyReplyId)) {
                        bokediv += "<div class='post-right-good post-right-goodin'>点赞(" + commentReply.thumbs + ")</div>"
                    } else {
                        bokediv += "<div id='canThumb" + replyReplyId + "' thumb-type='reply' class='post-right-good'>点赞(<span>" + commentReply.thumbs + "</span>)</div>"
                    }

                    bokediv += "<div cur-div-user-id='" + commentReply.userId + "' class='post-right-reply' belong-to-comment-id='" + commentId + "' user-name='" + userName + "' id='bokelzlinput" + replyReplyId + "'>回复</div>"
                    // bokediv+="</div>"
                    bokediv += "</div>"
                    bokediv += "</div>"
                    $(a).before(bokediv);
                }
            }

            var bokediv = "<div class='post2' id='bokelzlIninputall" + commentId + "'>"
            bokediv += "<div class='post-left'></div>"
            // bokediv+="<div class='post-lzl' style='padding-bottom: 0px'>"//                     <div class="post-lzl" style="padding-bottom: 0px">
            bokediv += "<div class='post-lzl-right'>"
            bokediv += "<div class='form-group' style='margin-top: 4px;''>"   //
            bokediv += "<input type='text' class='form-control' id='commentReply" + commentId + "' placeholder='请回复'>"    //
            bokediv += "<button id='commentReplyBtn" + commentId + "' type='button' class='btn btn-primary' style='margin-top: 5px;float: right;width:80px'>回复</button>"   //
            bokediv += "</div>"
            bokediv += "</div>"
            bokediv += "</div>"
            $(a).before(bokediv);
            isbutton1 = $(this).attr('id')
        }
    });
    $(document).on('click', 'div[id ^= bokelzlinput]', function () {
        if (isbutton2 == $(this).attr('id')) {
            $("#bokelzlIninputthis").remove();
            isbutton2 = ''
        } else {
            let replyId = $(this).attr('id').slice(12)
            let toReplyId = $(this).attr('belong-to-comment-id')
            let toReplyUserId = $(this).attr('cur-div-user-id')
            console.log(replyId)
            var a = '#bokelzlIn' + replyId
            console.log(a)
            $("#bokelzlIninputthis").remove();
            var bokediv = "<div class='post2' id='bokelzlIninputthis'>"
            bokediv += "<div class='post-left'></div>"
            // bokediv+="<div class='post-lzl' style='padding-bottom: 0px'>"
            bokediv += "<div class='post-lzl-right'>"
            bokediv += "<div class='form-group' style='margin-top: 4px;''>"   //
            bokediv += "<input type='text' class='form-control' id='replyReply" + replyId + "' placeholder='请回复'>"    //
            bokediv += "<button to-reply-user-id='" + toReplyUserId + "' to-reply-id='" + toReplyId + "' to-reply-name='" + $(this).attr('user-name') + "' id='replyReplyBtn" + replyId + "' type='button' class='btn btn-primary' style='margin-top: 5px;float: right;width:80px'>回复</button>"   //
            bokediv += "</div>"
            bokediv += "</div>"
            bokediv += "</div>"
            $(a).after(bokediv);
            isbutton2 = $(this).attr('id')
        }
    });

    $(document).on('click', 'button[id ^= commentReplyBtn]', function () {
        let commentId = $(this).attr('id').slice(15);
        // console.log("触发评论回复按钮"+commentReplyId)
        let commentReplyVal = $("#commentReply" + commentId).val()
        let commentReplyId = null
        let commentReplyTime = null
        // 插入一条对评论的回复并返回该回复的id及回复时间
        $.ajax({
            "url": "/post/user/to/reply",
            "type": "post",
            "data": {
                "commentId": commentId,
                "userId": [[${session.loginUser.id}]],
                "content": commentReplyVal
            },
            "async": false,
            "dataType": "json",
            "success": function (responseData) {
                let code = responseData.code;
                if (code == "200") {
                    let commentReply = responseData.data
                    commentReplyId = commentReply.id
                    let tmp = commentReply.time.replace(/T/, ' ')
                    commentReplyTime = tmp.substring(0, tmp.lastIndexOf("."))
                } else {
                    layer.open({
                        title: '提示',
                        content: '回复失败，服务器繁忙'
                        , btn: ['确定']
                        , btn1: function (index, layero) {
                            layer.close(index)
                        }
                    })
                    console.log("回复失败，错误信息：" + responseData.message)
                }
            },
            "error": function (res) {
                layer.msg("回复失败：" + res.status)
                console.log("回复失败，错误信息：" + res.statusText)
            }
        })
        let userCommentReplyDiv = "<div class='post2' id='bokelzlIn" + commentReplyId + "'>"
        userCommentReplyDiv += "<div class='post-left'></div>"
        userCommentReplyDiv += "<div class='post-lzl-right'>"
        userCommentReplyDiv += "<span id='" + [[${session.loginUser.id}]] + "' class='post-lzl-name'>" + curUser + "</span><span style='margin-right: 20px;'>:</span>"
        userCommentReplyDiv += commentReplyVal
        userCommentReplyDiv += "<div class='post-right-data'>" + commentReplyTime + "</div>"
        // post-right-goodin
        userCommentReplyDiv += "<div id='canThumb" + commentReplyId + "' thumb-type='reply' class='post-right-good'>点赞(<span>0</span>)</div>"
        userCommentReplyDiv += "<div class='post-right-reply' belong-to-comment-id='" + commentId + "' user-name='" + curUser + "' id='bokelzlinput" + commentReplyId + "'>回复</div>"
        // bokediv+="</div>"
        userCommentReplyDiv += "</div>"
        userCommentReplyDiv += "</div>"
        $("#commentReply" + commentId).val("")
        $("#bokelzlIninputall" + commentId).before(userCommentReplyDiv)

    })

    $(document).on('click', 'button[id ^= replyReplyBtn]', function () {
        let replyReplyId = $(this).attr('id').slice(13)
        let belongCommentId = $(this).attr('to-reply-id')
        let toReplyUserId = $(this).attr('to-reply-user-id')
        console.log("当前用户回复的评论回复所属的评论id：" + belongCommentId)
        // console.log("触发评论回复按钮"+commentReplyId)
        let replyReplyVal = $("#replyReply" + replyReplyId).val()
        let newReplyId = null
        let replyReplyTime = null;

        // 插入一条对评论回复的回复并返回该回复的id及回复时间，已获取所属评论id，可以放入评论回复表
        $.ajax({
            "url": "/post/user/to/reply",
            "type": "post",
            "data": {
                "commentId": belongCommentId,
                "userId": [[${session.loginUser.id}]],
                "content": replyReplyVal,
                "commentReplyId": replyReplyId
            },
            "async": false,
            "dataType": "json",
            "success": function (responseData) {
                let code = responseData.code;
                if (code == "200") {
                    let commentReply = responseData.data
                    newReplyId = commentReply.id
                    let tmp = commentReply.time.replace(/T/, ' ')
                    replyReplyTime = tmp.substring(0, tmp.lastIndexOf("."))
                } else {
                    layer.open({
                        title: '提示',
                        content: '回复失败，服务器繁忙'
                        , btn: ['确定']
                        , btn1: function (index, layero) {
                            layer.close(index)
                        }
                    })
                    console.log("回复失败，错误信息：" + responseData.message)
                }
            },
            "error": function (res) {
                layer.msg("回复失败：" + res.status)
                console.log("回复失败，错误信息：" + res.statusText)
            }
        })
        let userReplyReplyDiv = "<div class='post2' id='bokelzlIn" + newReplyId + "'>"
        userReplyReplyDiv += "<div class='post-left'></div>"
        userReplyReplyDiv += "<div class='post-lzl-right'>"
        userReplyReplyDiv += "<span id='" + [[${session.loginUser.id}]] + "' class='post-lzl-name'>" + curUser + "</span>回复<span id='" + toReplyUserId + "' class='post-lzl-name'>" + $(this).attr('to-reply-name') + "</span><span style='margin-right: 20px;'>:</span>"
        userReplyReplyDiv += replyReplyVal
        userReplyReplyDiv += "<div class='post-right-data'>" + replyReplyTime + "</div>"
        // post-right-goodin
        userReplyReplyDiv += "<div id='canThumb" + newReplyId + "' thumb-type='reply' class='post-right-good'>点赞(<span>0</span>)</div>"
        userReplyReplyDiv += "<div cur-div-user-id='" + [[${session.loginUser.id}]] + "' class='post-right-reply' belong-to-comment-id='" + belongCommentId + "' user-name='" + curUser + "' id='bokelzlinput" + newReplyId + "'>回复</div>"
        // bokediv+="</div>"
        userReplyReplyDiv += "</div>"
        userReplyReplyDiv += "</div>"
        $("#bokelzlIninputthis").remove();
        $("#bokelzlIninputall" + belongCommentId).before(userReplyReplyDiv)
    })

    $(document).on('click', '#laquo', function () {
        window.location.href = "/post/show/post/page/" + [[${postId}]] + "/" + 1
    });
    $(document).on('click', '#raquo', function () {
        window.location.href = "/post/show/post/page/" + [[${postId}]] + "/" + testboke.pages
    });
    $(document).on('click', 'li[id ^= page]', function () {
        $("#laquo").removeClass("disabled")
        $("#raquo").removeClass("disabled")
        $("li[id ^= page]").remove();
        var pageli = ''
        if (testboke.pages > 5) {
            if ($(this).find("a").html() < 3) {
                for (var i = 0; i < 5; i++) {
                    if (i == $(this).find("a").html() - 1) {
                        pageli += "<li id='page' class='active'><a class='buttonfengye'>" + (i + 1) + "</a></li>"
                    } else {
                        pageli += "<li id='page'><a class='buttonfengye'>" + (i + 1) + "</a></li>"
                    }
                }
            } else {
                if ($(this).find("a").html() > testboke.pages - 2) {
                    for (var i = 0; i < 5; i++) {
                        if ((testboke.pages + i - 4) == $(this).find("a").html()) {
                            pageli += "<li id='page' class='active'><a class='buttonfengye'>" + (testboke.pages + i - 4) + "</a></li>"
                        } else {
                            pageli += "<li id='page'><a class='buttonfengye'>" + (testboke.pages + i - 4) + "</a></li>"
                        }
                    }
                } else {
                    for (var i = 0; i < 5; i++) {
                        if (i == 2) {
                            pageli += "<li id='page' class='active'><a class='buttonfengye'>" + (Number($(this).find("a").html()) + i - 2) + "</a></li>"
                        } else {
                            pageli += "<li id='page'><a class='buttonfengye'>" + (Number($(this).find("a").html()) + i - 2) + "</a></li>"
                        }
                    }
                }
            }

            if ($(this).find("a").html() == 1) {
                $("#laquo").addClass("disabled")
            }
            if ($(this).find("a").html() == testboke.pages) {
                $("#raquo").addClass("disabled")
            }
        } else {
            for (var i = 0; i < testboke.pages; i++) {
                if (i == $(this).find("a").html() - 1) {
                    pageli += "<li id='page' class='active'><a class='buttonfengye'>" + (i + 1) + "</a></li>"
                } else {
                    pageli += "<li id='page'><a class='buttonfengye'>" + (i + 1) + "</a></li>"
                }
                if ($(this).find("a").html() == 1) {
                    $("#laquo").addClass("disabled")
                }
                if ($(this).find("a").html() == testboke.pages) {
                    $("#raquo").addClass("disabled")
                }
            }
        }
        $("#raquo").before(pageli);

        if ([[${current}]] != $(this).find("a").html()) {
            window.location.href = "/post/show/post/page/" + [[${postId}]] + "/" + $(this).find("a").html()
        }
    });
    $("#go").click(function () {
        // console.log('asdasd',$("#editor").html())
        // 回帖
        $.ajax({
            "url": "/post/user/to/comment",
            "type": "post",
            "data": {
                "postId": [[${postId}]],
                "userId": [[${session.loginUser.id}]],
                "content": $("#editor").html()
            },
            "dataType": "json",
            "success": function (responseData) {
                let code = responseData.code;
                if (code == "200") {
                    layer.open({
                        title: '提示',
                        content: '回帖成功'
                        , btn: ['确定']
                        , btn1: function (index, layero) {
                            layer.close(index)
                            // 跳转到当前帖子的最后一页
                            if (testboke.total != 0 && testboke.total % testboke.size == 0) {
                                window.location.href = "/post/show/post/page/" + [[${postId}]] + "/" + (testboke.pages + 1)
                            } else {
                                window.location.href = "/post/show/post/page/" + [[${postId}]] + "/" + (testboke.pages)
                            }
                        }
                    })
                } else {
                    layer.open({
                        title: '提示',
                        content: '回帖失败，服务器繁忙'
                        , btn: ['确定']
                        , btn1: function (index, layero) {
                            layer.close(index)
                        }
                    })
                    console.log("回帖失败，错误信息：" + responseData.message)
                }
            },
            "error": function (res) {
                layer.msg("回帖失败：" + res.status)
                console.log("回帖失败，错误信息：" + res.statusText)
            }
        })
    });

    $(document).on('click', 'div[id ^= canThumb]', function () {
        // 用户点赞
        let thumbDiv = $(this)
        let hasThumbId = thumbDiv.attr('id').slice(8)
        let thumbType = thumbDiv.attr('thumb-type')
        let type = thumbType == 'post' ? 1 : (thumbType == 'comment' ? 2 : 3)
        let userId = [[${session.loginUser.id}]]

        $.ajax({
            "url": "/post/user/thumb",
            "type": "post",
            "data": {
                "userId": userId,
                "type": type,
                "hasThumbId": hasThumbId
            },
            "async": false,
            "dataType": "json",
            "success": function (responseData) {
                let code = responseData.code;
                if (code !== "200") {
                    layer.open({
                        title: '提示',
                        content: '点赞失败，服务器繁忙'
                        , btn: ['确定']
                        , btn1: function (index, layero) {
                            layer.close(index)
                        }
                    })
                    console.log("点赞失败，错误信息：" + responseData.message)
                } else {
                    let spanText = thumbDiv.children().eq(0).text()
                    console.log("当前点赞按钮的点赞数" + spanText)
                    thumbDiv.children().eq(0).text(parseInt(spanText) + 1)
                    thumbDiv.addClass("post-right-goodin")
                    thumbDiv.removeAttr("id")
                }
            },
            "error": function (res) {
                layer.msg("点赞失败：" + res.status)
                console.log("点赞失败，错误信息：" + res.statusText)
            }
        })
    })

    $(document).on('click', '#starImg', function () {
        let img = $(this)
        let postId = [[${postId}]]
        let src = $(this).attr('src')
        let status = src.substring(src.lastIndexOf("-") + 1)
        let url = status == "off.jpg" ? "/user/personal/save/user/star" : "/user/personal/rem/user/star"

        // 用户收藏/取消收藏当前帖子
        $.ajax({
            "url": url,
            "type": "post",
            "data": {
                "starId": postId,
                "userId": [[${session.loginUser.id}]]
            },
            "dataType": "json",
            "success": function (responseData) {
                if (responseData.code == 200) {
                    // console.log(responseData.data)
                    if (status == "off.jpg") {
                        img.attr('src', "img/star-on.png")
                        layer.open({
                            title: '提示',
                            content: '已收藏'
                            , btn: ['确定']
                            , btn1: function (index, layero) {
                                layer.close(index)
                            }
                        })
                    } else {
                        img.attr('src', "img/star-off.jpg")
                        layer.open({
                            title: '提示',
                            content: '已取消收藏'
                            , btn: ['确定']
                            , btn1: function (index, layero) {
                                layer.close(index)
                            }
                        })
                    }
                }
            }
        })
    })
</script>
</html>
