<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <base th:href="@{/}"/>
    <title>某校坛</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/layui.css">
    <style>
        /* 导航栏不折叠 */
        /* 最小宽度 */
        .text-right {
            width: 13px;
            height: 13px;
            float: right;
            margin-top: 4px;
        }

        .div0 {
            min-width: 970px;
            background-color: #f5f6f7;
            /*background-color: rgb(250, 250, 250);*/
            /*background: url(img/beijing.jpg);*/
            min-height: 1000px;
        }

        li {
            cursor: pointer;
        }

        /* ======================= */
        /* ===阿里图库的图片样式 === */
        /* ======================= */
        .icon {
            width: 1.3em;
            height: 1.3em;
            vertical-align: -0.3em;
            fill: currentColor;
            overflow: hidden;
        }

        .row1 {
            margin-top: 80px;
        }

        .div-left-top {
            /* border:solid 1px rgb(170, 170, 170);
            border-radius: 6px; */
            background-color: #fff;

        }

        .div-left-top1 {
            line-height: 5px;
            background-color: #DDD;
            height: 40px;
        }

        .div-left-bottom {
            height: 112px;
            padding-left: 3%;
        }

        .div-left-bottom-in {
            margin-top: 10px;
        }

        .div2-left-top {
            /* border:solid 1px rgb(170, 170, 170);
            border-radius: 6px; */
            margin-top: 30px;
            background-color: #fff;
        }

        .div2-left-top1 {
            line-height: 5px;
            background-color: #DDD;
            height: 40px;
        }

        .media-heading {
            width: 5em;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .media-heading:hover {
            color: cornflowerblue;
            cursor: pointer;
        }

        .media-object:hover {
            cursor: pointer;
        }

        .div-left-bottom-in-sum1 {
            color: #AAA;
            font-size: 12px;
        }

        .div-left-bottom-in-sum2 {
            color: #666;
            font-size: 14px;
            width: 5em;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .GZbutton {
            margin-top: 10px;
            margin-left: 12px;
            text-align: center;
            padding: 1px;
            border: solid 1px rgb(255, 61, 61);
            color: rgb(255, 61, 61);
            width: 45px;
            border-radius: 25px;
            cursor: pointer;
        }

        .NGbutton {
            margin-top: 10px;
            margin-left: 12px;
            text-align: center;
            padding: 1px;
            border: solid 1px rgb(196, 186, 185);
            color: rgb(196, 186, 185);
            width: 45px;
            border-radius: 25px;
            cursor: not-allowed;
        }

        .YGbutton {
            margin-top: 10px;
            margin-left: 12px;
            text-align: center;
            padding: 1px;
            border: solid 1px rgb(196, 186, 185);
            color: rgb(196, 186, 185);
            width: 55px;
            border-radius: 25px;
            cursor: not-allowed;
        }

        .div2-left-bottom {

        }

        .div2-left-bottom-tr {
            cursor: pointer;
        }

        .div2-left-bottom-td {
            width: 500px;
        }

        .div-right-top {
            height: 120px;
            width: 250px;
            background-color: rgb(255, 255, 255);
            border-radius: 10px;
        }

        .div-right-top-in {
            /* margin-top: 20px; */
            position: relative;
        }

        .div-right-top-in-img {
            position: absolute;
            top: 15px;
            left: 15px;
        }

        .div-right-top-in-user {
            position: absolute;
            top: 20px;
            left: 120px;
            color: black;
            font-size: 16px;
            font-weight: bold;
            /*border: 1px blueviolet solid;*/
            width: 115px;
        }

        .logout {
            float: right;
        }

        .logout:hover {
            color: #953b39;
            cursor: pointer;
        }

        .headImg:hover {
            cursor: pointer;
        }

        .div-right-top-in-button1 {
            position: absolute;
            left: 120px;
            top: 50px;
            /*text-align: center;*/

            padding-left: 13px;
            padding-top: 1px;
            border: solid 1px rgb(255, 61, 61);
            color: rgb(255, 61, 61);
            width: 115px;
            border-radius: 25px;
            /*cursor: pointer;*/
        }

        .div-right-top-in-button3 {
            position: absolute;
            left: 120px;
            top: 80px;
            /*text-align: center;*/
            padding-left: 13px;
            padding-top: 1px;
            border: solid 1px rgb(255, 61, 61);
            color: rgb(255, 61, 61);
            width: 115px;
            border-radius: 25px;
            /*cursor: pointer;*/
        }

        .div-right-top-center {
            margin-top: 50px;
            width: 250px;
            background-color: rgb(255, 255, 255);
            border-radius: 10px;
        }

        .div-right-top-bottom {
            cursor: pointer;
            margin-top: 20px;
            text-align: center;
            padding: 5px;
            color: rgb(255, 255, 255);
            width: 250px;
            background-color: #00A0E4;
            border-radius: 6px;
        }

        .div-right-top-bottom:hover {
            background-color: #008bc7;
        }

        .text-left {
            display: inline-block;
            text-align: center;
            color: white;
            font-weight: bold;
            background-color: orange;
            height: 20px;
            width: 20px;
        }

        .text-left2 {
            display: inline-block;
            text-align: center;
            color: rgb(155, 155, 155);
            font-weight: bold;
            height: 20px;
            width: 20px;
        }

        @media screen and (max-width: 1200px) {
            #myScrollspy {
                display: none;
            }
        }

        .post-type:hover {
            cursor: pointer;
            color: #0e90d2;
        }

        .post-title {
            font-weight: bold;
        }

        .post-title:hover {
            color: #FD482C;
        }
    </style>
    <script src='js/iconfont.js'></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="layer/layer.js"></script>
    <script th:inline="javascript">
        // console.log([[${session.loginUser}]])
        let map = [
            ["技术交流", 1],
            ["校闻趣事", 2],
            ["社团活动", 3],
            ["校园一角", 4],
            ["美食佳肴", 5],
            ["政史评谈", 6]
        ]
        $(function () {
            // 获取用户未读动态及消息
            $.ajax({
                "url": "/user/personal/get/user/unread/" + [[${session.loginUser.id}]],
                "type": "get",
                "dataType": "json",
                "success": function (responseData) {
                    if (responseData.code == 200){
                        let unreadPair = responseData.data
                        let unreadActs = unreadPair.key
                        let unreadMsgs = unreadPair.value

                        if (unreadActs != 0) {
                            let unreadSpan = "<span class='layui-badge  layui-bg-green' style='margin-left: 2px'>" + unreadActs + "</span>"
                            $("#activity a").append(unreadSpan)
                        }
                        if (unreadMsgs != 0) {
                            let unreadSpan = "<span class='layui-badge  layui-bg-green' style='margin-left: 2px'>" + unreadMsgs + "</span>"
                            $("#message a").append(unreadSpan)
                        }
                    }
                }
            })
            $("#toPost").click(function () {
                window.location.href = "/post/to/post"
            })
            $(".logout").click(function () {
                window.location.href = "/ident/logout"
            })
            $(".headImg").click(function () {
                console.log(this.id)
                window.location.href = "/user/zone/page/" + this.id
            })
            $(".div-left-bottom-in").eq(0).css("margin-top", "10px")
            $(".div-left-bottom-in").eq(3).attr("style", "width: 25%; padding-top: 10px")
            $.ajax({
                "url": "/ident/get/user/info/" + [[${session.loginUser.id}]],
                "type": "get",
                // "data":{
                //     "phoneNum":phoneNum
                // },
                "dataType": "json",
                "async": false,
                "success": function (responseData) {
                    let code = responseData.code;
                    if (code == "200") {
                        let data = responseData.data;
                        if (data.headUrl != null) {
                            $(".headImg").attr("src", data.headUrl);
                            $("#lis").prepend(
                                "<li>" +
                                "   <a style='width: 58px; height: 50px;' href='http://www.huanforum.com/user/zone/page/" + [[${session.loginUser.id}]] + "'>" +
                                "       <img class='img-circle' width='30px' height='30px' src='" + data.headUrl + "'/>" +
                                "   </a>" +
                                "</li>"
                            )
                        }
                        $(".div-right-top-in-button1").text("粉丝数 " + data.fans);
                        $(".div-right-top-in-button3").text("访问量 " + data.allVisits);
                    } else {
                        layer.msg("获取用户信息失败：" + responseData.message);
                    }

                },
                "error": function (response) {
                    layer.msg(response.status + " " + response.statusText);
                }
            });

            //查询用户关注的人id
            $.ajax({
                "url": "/user/personal/get/user/subscribes/" + [[${session.loginUser.id}]],
                "type": "get",
                "dataType": "json",
                "success": function (responseData) {
                    let code = responseData.code;
                    if (code == "200") {
                        let data = responseData.data;
                        console.log(data)
                        // console.log($(".GZbutton"))
                        let gzs = $(".GZbutton")
                        for (let i = 0; i < gzs.length; i++) {
                            let gz = gzs.eq(i)
                            let isSubscribeId = gz.attr('id')
                            // console.log(isSubscribeId)
                            if (isSubscribeId == [[${session.loginUser.id}]]) {
                                gz.removeClass("GZbutton")
                                gz.addClass("NGbutton")
                                continue
                            }
                            if ($.inArray(parseInt(isSubscribeId), data) >= 0) {
                                gz.removeClass("GZbutton")
                                gz.addClass("YGbutton")
                                gz.text("已关注")
                            }
                        }
                    } else {
                        layer.msg("获取关注信息失败：" + responseData.message);
                    }

                },
                "error": function (response) {
                    layer.msg(response.status + " " + response.statusText);
                }
            });
            //已关注的人则换按钮样式
            $(".GZbutton")

            $(".post-title").click(function () {
                // console.log(this)
                window.location.href = "/post/show/post/page/" + this.id + "/1"
            })
        })
        $(document).on('click', '.media-heading', function () {
            let userId = $(this).attr('id')
            // console.log(userId)
            window.location.href = "/user/zone/page/" + userId
        })
        $(document).on('click', '.media-object', function () {
            let userId = $(this).attr('id')
            // console.log(userId)
            window.location.href = "/user/zone/page/" + userId
        })
        $(document).on('click', '.post-type', function () {
            let typeTxt = $(this).text()
            let type = null
            for (let i = 0; i < map.length; i++) {
                let typeArr = map[i]
                if (typeArr[0] == typeTxt) {
                    type = typeArr[1]
                    break
                }
            }

            window.location.href = "/post/show/" + type
        })
        //点击关注
        $(document).on('click', '.GZbutton', function () {
            let gz = $(this)
            let subscribeId = $(this).attr('id')
            // console.log(id)
            let userId = [[${session.loginUser.id}]]
            $.ajax({
                "url": "/user/personal/save/user/subscribes",
                "type": "post",
                "data": {
                    "userId": userId,
                    "subscribeId": subscribeId
                },
                "dataType": "json",
                "success": function (responseData) {
                    if (responseData.code != 200) {
                        layer.open({
                            title: '提示',
                            content: '关注失败，服务器繁忙'
                            , btn: ['确定']
                            , btn1: function (index, layero) {
                                layer.close(index)
                            }
                        })
                        console.log("关注失败，错误信息：" + responseData.message)
                    } else {
                        gz.removeClass("GZbutton")
                        gz.addClass("YGbutton")
                        gz.text("已关注")
                    }
                },
                "error": function (res) {
                    layer.msg("关注失败：" + res.status)
                    console.log("关注失败，错误信息：" + res.statusText)
                }
            })
        })
    </script>
</head>
<body>
<div class="div0">
    <div th:replace="nav-head :: head"></div>
    <div class="container">
        <div class="row row1">
            <div class="col-lg-9 col-md-12" style="width:850px">
                <div class="div-left-top">
                    <div class="div-left-top1">
                        <h4 class="pull-left" style="font-weight:400;margin-top: 11px;">&nbsp;&nbsp;周飙升榜</h4>
                        <h5 class="pull-right" style="margin-top: 14px;margin-right: 20px;color:#888;cursor: pointer;">
                        </h5>
                    </div>
                    <div class="div-left-bottom">
                        <div th:each="weekHotUser : ${weekHotUsers}" class="media div-left-bottom-in"
                             style="width:25% ;float:left">
                            <div class="media-left">
                                <th:block th:if="${weekHotUser.headUrl == null}">
                                    <img src="https://static.runoob.com/images/mix/img_avatar.png" class="media-object"
                                         style="width:90px; height: 90px">
                                </th:block>
                                <th:block th:if="${weekHotUser.headUrl != null}">
                                    <img th:id="${weekHotUser.userId}" th:src="${weekHotUser.headUrl}"
                                         class="media-object"
                                         style="width:90px; height: 90px">
                                </th:block>
                            </div>
                            <div class="media-body">
                                <h4 class="media-heading" th:id="${weekHotUser.userId}" th:text="${weekHotUser.name}">
                                    帖主</h4>
                                <div class="button"><span class="div-left-bottom-in-sum1">人气：</span><span
                                        class="div-left-bottom-in-sum2" th:text="${weekHotUser.weekVisits}">6555</span>
                                </div>
                                <div class="GZbutton" th:id="${weekHotUser.userId}">关注</div>
                                <div></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="div2-left-top">
                    <div class="div2-left-top1">
                        <h4 class="pull-left" style="font-weight:400;margin-top: 11px;">&nbsp;&nbsp;热帖</h4>
                        <h5 class="pull-right" style="margin-top: 14px;margin-right: 20px;color:#888;cursor: pointer;">
                        </h5>
                    </div>
                    <div class="">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th style="font-weight: lighter;color: #9d9d9d" class="div2-left-bottom-td">标题</th>
                                <th style="font-weight: lighter;color: #9d9d9d">类型</th>
                                <th style="font-weight: lighter;color: #9d9d9d">提问人</th>
                                <th style="font-weight: lighter;color: #9d9d9d">回复数</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="weekHotPost : ${weekHotPosts}">
                                <td class="post-title div2-left-bottom-tr" th:id="${weekHotPost.postId}"
                                    th:text="${weekHotPost.title}">Tanmay
                                </td>
                                <td style="color: cornflowerblue" class="post-type" th:text="${weekHotPost.type}">
                                    Bangalore
                                </td>
                                <td th:text="${weekHotPost.name}">560001</td>
                                <td th:text="${weekHotPost.replies}">560001</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-3" id="myScrollspy">
                <div data-spy="affix" data-offset-top="0">
                    <div class="div-right-top">
                        <div v-if="true" class="div-right-top-in">
                            <img src="https://static.runoob.com/images/mix/img_avatar.png"
                                 class="img-circle div-right-top-in-img headImg" style="width:90px"
                                 th:id="${session.loginUser.id}">
                            <th:block th:if="${session.loginUser != null}">
                                <div class="div-right-top-in-user">[[${session.loginUser.name}]]<span
                                        class="logout">退出</span></div>
                            </th:block>
                            <div class="div-right-top-in-button1"></div>
                            <div class="div-right-top-in-button3"></div>
                        </div>
                    </div>
                    <div class="div-right-top-center">
                        <div class="">
                            <a class="list-group-item active">论贴分类</a>
                            <a href="post/show/1" class="list-group-item">
                                <img src="img/jiantouhui.png" class="text-right"/>
                                技术交流
                            </a>
                            <a href="post/show/2" class="list-group-item">
                                <img src="img/jiantouhui.png" class="text-right"/>
                                校闻趣事
                            </a>
                            <a href="post/show/3" class="list-group-item">
                                <img src="img/jiantouhui.png" class="text-right"/>
                                社团活动
                            </a>
                            <a href="post/show/4" class="list-group-item">
                                <img src="img/jiantouhui.png" class="text-right"/>
                                校园一角
                            </a>
                            <a href="post/show/5" class="list-group-item">
                                <img src="img/jiantouhui.png" class="text-right"/>
                                美食佳肴
                            </a>
                            <a href="post/show/6" class="list-group-item">
                                <img src="img/jiantouhui.png" class="text-right"/>
                                政史评谈
                            </a>
                        </div>
                    </div>
                    <div class="div-right-top-bottom" id="toPost">
                        发帖
                    </div>
                </div>

            </div>

        </div>
    </div>
</div>
</body>
</html>
